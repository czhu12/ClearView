import Head from 'next/head'
import Pipeline from '../src/utils/Pipeline';
import { useState } from 'react'
import Button from 'react-bootstrap/Button';
import Form from 'react-bootstrap/Form';
import ToCanvas from '../src/utils/ToCanvas';
import CropImage from '../src/utils/CropImage';

import styles from '../styles/Home.module.css'

export default function Playground() {
  const [base64, setBase64] = useState("");
  const clicked = async () => {
    const state = {base64}
    const pipeline = new Pipeline([
      new ToCanvas(512, 512),
      new CropImage({percentageOfX: .5, percentageOfY: .5, width: 100, height: 100})
    ]);
    const { result, reason } = await pipeline.execute(state);
    if (result) {
      const context = document.getElementById('output-canvas').getContext('2d');
      context.drawImage(state.canvas, 0, 0);
    }
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Playground</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className="my-5">
        <h4>Playground</h4>
        <Form.Control value={base64} onChange={(e) => setBase64(e.target.value)} as="textarea" rows={4} />
        <div className="mt-2 mb-5">
          <Button onClick={clicked}>Submit</Button>
        </div>

        <h4>Output</h4>
        <canvas style={{border: "1px solid black"}} height="512" width="512" id="output-canvas"></canvas>
      </main>
    </div>
  )
}
